{% extends 'accounts/base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
  <div class="container-fluid py-5">
    <div class="row">
      <!-- Product Heading and Shop Now Button -->
      <div class="d-flex justify-content-between align-items-center">
        <h1>
          <span style="color: gold;">{{ name }}</span>
          <strong style="color: black;">|</strong>
          <span style="color: blue;">{{ category }}</span>
          <strong style="color: black;">|</strong>
          <span style="color: crimson;">{{ gender }}</span>
        </h1>

        <a href="{% url 'products:shop_homepage' %}" class="btn btn-warning text-uppercase fw-bold">Shop Now</a>
      </div>
      <hr />
      <!-- Product Description Section inside Bootstrap Card -->
      <div class="card mt-2">
        <div class="card-body">
          <h3 class="text-primary">Description</h3>
          <p class="lead">{{ description }}</p>
        </div>
      </div>
      <hr />

      <!-- Available Volumes Section -->
      <h2 class="text-center text-warning mb-4">Available Volumes</h2>
      {% if volumes %}
        <div class="row justify-content-center">
          {% for volume in volumes %}
            <div class="col-md-3 col-sm-6 col-12 mb-4">
              <div class="card text-center h-100 shadow-lg">
                <!-- Add h-100 class to make card fill available height -->
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">{{ volume.ml }} ML</h5>

                  {% if volume.discount_value %}
                    <!-- Discount badge -->
                    <span class="badge bg-danger position-absolute top-0 end-0 translate-middle-y py-2 px-4">-{{ volume.discount_value }}%</span>
                  {% endif %}

                  {% if volume.image %}
                    <!-- Volume Image -->
                    <img src="{{ volume.image }}" alt="{{ volume.ml }} ML Image" class="img-fluid rounded mb-3" style="max-width: 100px; height: auto;" />
                  {% endif %}

                  <p class="card-text">
                    {% if volume.discount_value %}
                      <!-- Discounted Price -->
                      <strong>Original Price:</strong> <span class="text-muted text-decoration-line-through">UgX{{ volume.price|floatformat:'2'|intcomma }}</span><br />
                      <strong>Discounted Price:</strong> <span class="text-success">UgX{{ volume.discounted_price|floatformat:'2'|intcomma }}</span>
                    {% else %}
                      <!-- Regular Price without cancellation -->
                      <strong>Price:</strong> <span class="text-success">UgX{{ volume.price|floatformat:'2'|intcomma }}</span>
                    {% endif %}
                  </p>

                  <p class="card-text mb-0">
                    <strong>Type:</strong> {{ volume.product_type }}
                  </p>

                  <!-- Flex grow to ensure the card stretches evenly -->
                  <div class="mt-auto"></div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-center text-danger">No volumes available for this product.</p>
      {% endif %}

      {% if error %}
        <p class="text-center text-danger">{{ error }}</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
